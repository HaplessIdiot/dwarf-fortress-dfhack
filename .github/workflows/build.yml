      - name: Create non-root builder user and build package
        run: |
          set -euxo pipefail

          # create builder user with bash as shell
          useradd -m -s /bin/bash builder
          echo 'builder ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers
          chown -R builder:builder "$GITHUB_WORKSPACE"

          # show files for debug
          su - builder -c "cd $GITHUB_WORKSPACE && ls -la || true"

          # Build inside builder account using bash so makepkg sources PKGBUILD with bash
          su - builder -c "bash -lc '
            set -euxo pipefail
            cd \"$GITHUB_WORKSPACE\"

            # Optional: show pinned_libs contents if present
            if [[ -d pinned_libs ]]; then
              ls -la pinned_libs || true
            fi

            # Makepkg options:
            # -s : install missing deps from repos (builder has no sudo, but base-devel installed earlier)
            # -f : force overwrite existing package files
            # --skippgpcheck : skip signing verification in CI
            MAKEFLAGS=\"-j2\" PKGEXT=\".pkg.tar.zst\" makepkg -sf --noconfirm --skippgpcheck
          '"
          
